{% extends "base.html" %}
{% block title %}Contact Us{% endblock title %}

{% block content %}
<div class="container section-padding">
  <!-- Contact Section -->
  <section class="container">
    <div class="text-center mb-5" data-aos="fade-up">
      <h6 class="text-primary fw-bold text-uppercase">Get in Touch</h6>
      <h2 class="mb-3">Contact Us</h2>
      <p class="text-secondary mx-auto" style="max-width: 600px;">We are here to answer any questions you may have about
        our services. Reach out to us and we'll respond as soon as we can.</p>
    </div>

    <div class="row g-4">
      <!-- Contact Form -->
      <div class="col-md-7" data-aos="fade-right">
        <div class="card p-4 p-md-5 h-100 border-0 shadow-lg">
          <h4 class="mb-4 fw-bold text-secondary">Send us a Message</h4>
          <form id="contactForm" method="post" novalidate>
            {% csrf_token %}

            <div class="mb-3">
              <label class="form-label fw-semibold">{{ contact_form.name.label }}</label>
              {{ contact_form.name }}
              <div class="text-danger d-none small mt-1">This field is required.</div>
            </div>

            <div class="mb-3">
              <label class="form-label fw-semibold">{{ contact_form.email.label }}</label>
              {{ contact_form.email }}
              <div class="text-danger d-none small mt-1">This field is required.</div>
            </div>

            <div class="mb-3">
              <label class="form-label fw-semibold">{{ contact_form.phone.label }}</label>
              {{ contact_form.phone }}
              <div class="text-danger d-none small mt-1">This field is required.</div>
            </div>

            <div class="mb-3">
              <label class="form-label fw-semibold">{{ contact_form.message.label }}</label>
              {{ contact_form.message }}
              <div class="text-danger d-none small mt-1">This field is required.</div>
            </div>

            <button id="submitBtn" type="submit" class="btn btn-primary w-100 py-2 mt-3 fw-bold">
              Send Message <span id="loadingSpinner" class="spinner-border spinner-border-sm d-none ms-2"></span>
            </button>
          </form>

          <!-- Success/Error Alerts -->
          <div id="successMsg" class="alert alert-success mt-3 d-none"><i class="fa-solid fa-check-circle me-2"></i>
            Your message was sent successfully!</div>
          <div id="errorMsg" class="alert alert-danger mt-3 d-none"><i class="fa-solid fa-circle-exclamation me-2"></i>
            Something went wrong. Please try again.</div>
        </div>
      </div>

      <!-- Location & Map -->
      <div class="col-md-5" data-aos="fade-left">
        <div class="card p-4 h-100 border-0 shadow-lg">
          <h4 class="mb-4 fw-bold text-secondary">Our Location</h4>
          <div class="mb-4">
            <p class="mb-2"><i class="fa-solid fa-location-dot text-primary me-2"></i> <strong>Address:</strong></p>
            <p class="text-secondary ms-4">123 HealthCare Drive, Wellsville, NY 10012</p>
          </div>
          <div class="mb-4">
            <p class="mb-2"><i class="fa-solid fa-phone text-primary me-2"></i> <strong>Phone:</strong></p>
            <p class="text-secondary ms-4">(123) 456-7890</p>
          </div>
          <div class="mb-4">
            <p class="mb-2"><i class="fa-solid fa-envelope text-primary me-2"></i> <strong>Email:</strong></p>
            <p class="text-secondary ms-4">contact@healthcarehub.com</p>
          </div>

          <div class="ratio ratio-4x3 rounded overflow-hidden shadow-sm mt-auto">
            <iframe
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d36708166.63035599!2d60.07759268441987!3d19.193550900038495!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x30635ff06b92b791%3A0xd78c4fa1854213a6!2sIndia!5e0!3m2!1sen!2sin!4v1751212230275!5m2!1sen!2sin"
              style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- Scripts -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('contactForm');
    const fields = form.querySelectorAll('input, textarea');
    const submitBtn = document.getElementById('submitBtn');
    const spinner = document.getElementById('loadingSpinner');
    const successMsg = document.getElementById('successMsg');
    const errorMsg = document.getElementById('errorMsg');

    // Blur validation
    fields.forEach(field => {
      field.addEventListener('blur', () => {
        const errorDiv = field.nextElementSibling;
        if (field.value.trim() === '') {
          field.classList.add('is-invalid');
          errorDiv.classList.remove('d-none');
        } else {
          field.classList.remove('is-invalid');
          errorDiv.classList.add('d-none');
        }
      });
    });

    // AJAX form submission
    form.addEventListener('submit', function (e) {
      e.preventDefault();

      // Basic check before sending
      let isValid = true;
      fields.forEach(field => {
        const errorDiv = field.nextElementSibling;
        if (field.value.trim() === '') {
          field.classList.add('is-invalid');
          errorDiv.classList.remove('d-none');
          isValid = false;
        } else {
          field.classList.remove('is-invalid');
          errorDiv.classList.add('d-none');
        }
      });

      if (!isValid) return;

      // Submit via fetch
      spinner.classList.remove('d-none');
      submitBtn.disabled = true;

      const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
      const formData = new FormData(form);

      fetch("{% url 'contact' %}", {
        method: 'POST',
        headers: {
          'X-CSRFToken': csrfToken
        },
        body: formData
      })
        .then(response => {
          spinner.classList.add('d-none');
          submitBtn.disabled = false;

          if (response.ok) {
            form.reset();
            successMsg.classList.remove('d-none');
            errorMsg.classList.add('d-none');
            setTimeout(() => {
              successMsg.classList.add('d-none');
            }, 5000);
          } else {
            throw new Error('Network error');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          spinner.classList.add('d-none');
          submitBtn.disabled = false;
          successMsg.classList.add('d-none');
          errorMsg.classList.remove('d-none');
        });
    });
  });
</script>
{% endblock content %}